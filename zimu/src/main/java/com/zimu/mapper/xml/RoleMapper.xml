<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zimu.mapper.RoleMapper">

    <select id="selectRoleMenus" parameterType="map" resultType="com.zimu.domain.info.RoleMenuInfo">
        SELECT
        t1.menu_name AS menuName,
        t1.menu_href AS menuHref,
        t3.role_code AS roleCode,
        t3.role_name AS roleName
        FROM
        `t_menu` t1
        LEFT JOIN `t_role_menu` t2 ON t1.id = t2.menu_id
        LEFT JOIN `t_role` t3 ON t2.role_id = t3.id
        WHERE 1=1
        <if test="delFlag != null">
            AND t1.del_flag <![CDATA[<>]]> #{delFlag,jdbcType=INTEGER}
            AND t3.del_flag <![CDATA[<>]]> #{delFlag,jdbcType=INTEGER}
        </if>
        AND t1.menu_href IS NOT NULL
        AND t1.menu_href NOT LIKE '%javascript:void(0)%'
    </select>

    <select id="selectByUserId" parameterType="long" resultType="com.zimu.entity.RoleEntity">
        SELECT DISTINCT
            tr.*
        FROM
            t_role tr,
            t_user_role tur,
            t_user tu
        WHERE
            1 = 1
            AND tr.id = tur.role_id
            AND tur.user_id = tu.id
            AND tr.del_flag != 1
            AND tur.del_flag != 1
            AND tu.del_flag != 1
            AND tu.id = #{userId,jdbcType=BIGINT} UNION
        SELECT DISTINCT
            tr.*
        FROM
            t_role tr,
            t_group_role tgr,
            t_group tg,
            t_user_group tug,
            t_user tu
        WHERE
            1 = 1
            AND tr.id = tgr.role_id
            AND tgr.group_id = tg.id
            AND tg.id = tug.group_id
            AND tug.user_id = tu.id
            AND tr.del_flag != 1
            AND tgr.del_flag != 1
            AND tg.del_flag != 1
            AND tug.del_flag != 1
            AND tu.del_flag != 1
            AND tu.id = #{userId,jdbcType=BIGINT}
    </select>

</mapper>
